{% extends "base.html" %}

{% block content %}
<h1>{{ survey.title }}</h1>
<p>{{ survey.description }}</p>
<p><strong>–õ–∏–º–∏—Ç –æ—Ç–≤–µ—Ç–æ–≤:</strong> {{ survey.max_comments }}</p>

{% if survey.is_closed %}
    <p style="color:red;"><strong>–û–ø—Ä–æ—Å –∑–∞–∫—Ä—ã—Ç ‚Äî –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç.</strong></p>
{% endif %}

<h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>
<ul>
{% for comment in comments %}
  <li>
      <strong>{{ comment.user.username }}</strong>:
      {{ comment.comment }}
      <em>({{ comment.created_at|date:"d.m.Y H:i" }})</em>
      ‚Äî <span>{{ comment.likes }}</span>
      {% if user.is_authenticated %}
          <form method="post" action="{% url 'toggle_like' survey.pk comment.id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit">
                  {% if user in comment.liked_by.all %}
                      üëç –£–±—Ä–∞—Ç—å
                  {% else %}
                      üëç –õ–∞–π–∫
                  {% endif %}
              </button>
          </form>
      {% endif %}
  </li>
{% empty %}
  <li>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</li>
{% endfor %}
</ul>

{% if user.is_authenticated %}
  {% if survey.is_closed %}
      <p><em>–ù–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è.</em></p>
  {% elif existing_comment %}
      <p><em>–í—ã —É–∂–µ –æ—Å—Ç–∞–≤–∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</em></p>
  {% else %}
      <h3>–û—Å—Ç–∞–≤–∏—Ç—å –º–Ω–µ–Ω–∏–µ</h3>
      <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
  {% endif %}
{% else %}
  <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
{% endif %}

{% if error %}<p style="color:red;">{{ error }}</p>{% endif %}
{% endblock %}